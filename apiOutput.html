<!DOCTYPE html>  
<html lang="id">  
<head>  
  <meta charset="UTF-8" />  
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>  
  <title>Get output api</title>  

  <!-- Font Google -->  
  <link rel="preconnect" href="https://fonts.googleapis.com">  
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>  
  <link href="https://fonts.googleapis.com/css2?family=Exile&display=swap" rel="stylesheet">  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" />  

  <style>  
    body {  
      font-family: Arial, sans-serif;  
      padding: 30px;  
      background-color: #f0f0f0;  
    }  
    .container {  
      background-color: #fff;  
      padding: 20px;  
      border-radius: 10px;  
      box-shadow: 0 0 10px rgba(0,0,0,0.1);  
      max-width: 600px;  
      margin: auto;  
    }  
    input, button {  
      width: 100%;  
      padding: 10px;  
      margin-bottom: 15px;  
      border: 1px solid #ccc;  
      border-radius: 8px;  
    }  
    button {  
      background-color: #007bff;  
      color: white;  
      border: none;  
      cursor: pointer;  
      display: flex;  
      justify-content: center;  
      align-items: center;  
    }  
    h2 {  
      background: linear-gradient(to right, rgb(163,222,255), rgb(38,177,255));  
      -webkit-background-clip: text;  
      -webkit-text-fill-color: transparent;  
      font-family: Exile;  
    }  
    .spin {  
      animation: spin 1s linear infinite;  
    }  
    @keyframes spin {  
      0% { transform: rotate(0deg); }  
      100% { transform: rotate(360deg); }  
    }  
    #mediaContainer {  
      margin-top: 20px;  
    }  
    video, audio, img {  
      width: 100%;  
      margin-top: 10px;  
      border-radius: 10px;  
    }  
    pre {  
      background-color: #eee;  
      padding: 10px;  
      border-radius: 8px;  
      white-space: pre-wrap;  
      word-wrap: break-word;  
    }  
  </style>  
</head>  
<body>  
  <div class="container">  
    <h2>API OUTPUT</h2>  
    <input type="text" id="customApiInput" placeholder="Masukkan URL API" oninput="generateDynamicInputs()" />  
    <div id="dynamicInputs"></div>  
    <button id="submitBtn" onclick="getMedia()">  
      <span id="btnIcon" class="material-symbols-outlined">check_box_outline_blank</span>  
    </button>  
    <div id="mediaContainer"></div>  
    <pre id="responseBox" style="display:none;"></pre>  
  </div>  

  <script>  
    function generateDynamicInputs() {  
      const url = document.getElementById('customApiInput').value;  
      const matches = [...url.matchAll(/{(.*?)}/g)];  
      const dynamicInputArea = document.getElementById('dynamicInputs');  
      dynamicInputArea.innerHTML = '';  
      const usedNames = new Set();  
  
      matches.forEach(match => {  
        const param = match[1];  
        if (!usedNames.has(param)) {  
          usedNames.add(param);  
          const label = document.createElement('label');  
          label.textContent = `Masukkan nilai untuk "${param}":`;  
          const input = document.createElement('input');  
          input.type = 'text';  
          input.placeholder = param;  
          input.id = `param_${param}`;  
          dynamicInputArea.appendChild(label);  
          dynamicInputArea.appendChild(input);  
        }  
      });  
    }  
  
    async function getMedia() {  
      const btnIcon = document.getElementById('btnIcon');  
      const mediaContainer = document.getElementById('mediaContainer');  
      const responseBox = document.getElementById('responseBox');  
  
      btnIcon.textContent = 'autorenew';  
      btnIcon.classList.add('spin');  
      mediaContainer.innerHTML = '';  
      responseBox.style.display = 'none';  
  
      let urlTemplate = document.getElementById('customApiInput').value;  
      const matches = [...urlTemplate.matchAll(/{(.*?)}/g)];  
      matches.forEach(match => {  
        const param = match[1];  
        const inputEl = document.getElementById(`param_${param}`);  
        const value = inputEl?.value || '';  
        urlTemplate = urlTemplate.replace(`{${param}}`, encodeURIComponent(value));  
      });  
  
      // Validasi URL  
      try {  
        new URL(urlTemplate);  
      } catch (e) {  
        responseBox.textContent = "URL tidak valid. Harap masukkan URL yang benar.";  
        responseBox.style.display = 'block';  
        btnIcon.textContent = 'check_box_outline_blank';  
        btnIcon.classList.remove('spin');  
        return;  
      }  
  
      try {  
        const response = await fetch(urlTemplate);  
        const contentType = response.headers.get("content-type") || "";  
  
        if (!response.ok) throw new Error("Gagal memuat konten dari server.");  
  
        if (contentType.includes("text/html")) {  
          throw new Error("URL tidak valid atau bukan konten yang didukung (HTML terdeteksi).");  
        }  
  
        if (contentType.includes("image")) {  
          const blob = await response.blob();  
          const imageUrl = URL.createObjectURL(blob);  
          const img = document.createElement("img");  
          img.src = imageUrl;  
          mediaContainer.appendChild(img);  
        } else if (contentType.includes("video")) {  
          const blob = await response.blob();  
          const videoUrl = URL.createObjectURL(blob);  
          const video = document.createElement("video");  
          video.controls = true;  
          video.src = videoUrl;  
          mediaContainer.appendChild(video);  
        } else if (contentType.includes("audio")) {  
          const blob = await response.blob();  
          const audioUrl = URL.createObjectURL(blob);  
          const audio = document.createElement("audio");  
          audio.controls = true;  
          audio.src = audioUrl;  
          mediaContainer.appendChild(audio);  
        } else if (contentType.includes("application/json")) {  
          const data = await response.json();  
          responseBox.textContent = JSON.stringify(data, null, 2);  
          responseBox.style.display = 'block';  
        } else {  
          const text = await response.text();  
          responseBox.textContent = text;  
          responseBox.style.display = 'block';  
        }  
      } catch (err) {  
        responseBox.textContent = "Terjadi kesalahan: " + err.message;  
        responseBox.style.display = 'block';  
      } finally {  
        btnIcon.textContent = 'check_box_outline_blank';  
        btnIcon.classList.remove('spin');  
      }  
    }  
  </script>  
</body>  
</html>
